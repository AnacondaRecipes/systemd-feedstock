From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Ryan Volz <ryan.volz@gmail.com>
Date: Wed, 8 Jan 2025 15:17:27 -0500
Subject: [PATCH] missing_sched: add #define for CLONE_PIDFD added in Linux
 kernel 5.2

---
 src/basic/missing_sched.h | 7 +++++++
 src/basic/raw-clone.h     | 1 +
 2 files changed, 8 insertions(+)

diff --git a/src/basic/missing_sched.h b/src/basic/missing_sched.h
index bbfc30cc8f..d00740608f 100644
--- a/src/basic/missing_sched.h
+++ b/src/basic/missing_sched.h
@@ -20,6 +20,13 @@ assert_cc(CLONE_NEWCGROUP == 0x02000000);
 assert_cc(CLONE_NEWTIME == 0x00000080);
 #endif
 
+/* b3e5838252665ee4cfa76b82bdf1198dca81e5be (5.2) */
+#ifndef CLONE_PIDFD
+#  define CLONE_PIDFD 0x00001000
+#else
+assert_cc(CLONE_PIDFD == 0x00001000);
+#endif
+
 /* Not exposed yet. Defined at include/linux/sched.h */
 #ifndef PF_KTHREAD
 #  define PF_KTHREAD 0x00200000
diff --git a/src/basic/raw-clone.h b/src/basic/raw-clone.h
index 36202cc0ba..91b0069fb5 100644
--- a/src/basic/raw-clone.h
+++ b/src/basic/raw-clone.h
@@ -11,6 +11,7 @@
 
 #include "log.h"
 #include "macro.h"
+#include "missing_sched.h"
 #include "process-util.h"
 
 /**
-- 
2.46.0

